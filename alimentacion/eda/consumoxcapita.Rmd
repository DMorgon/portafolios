---
title: "EDA del consumo de alimentos de los hogares españoles"
author: "David Moreno"
date: "2023-08-23"
output: pdf_document
---
## Introducción

## 1. Instalación e importación de las librerias

Configuro el repositorio de CRAN de manera no interactiva

```{r}
options(repos = c(CRAN = "https://cran.r-project.org"))
```

Instalo las librerías que voy a utilizar

```{r}
install.packages("readr")
install.packages("tidyverse")
install.packages("httr")
install.packages("rmarkdown")
install.packages("dplyr")
```

Ahora cargo las librerías.

```{r}
library(readr)
library(tidyverse)
library(httr)
library(rmarkdown)
library(dplyr)
```

## 2. Carga de los datos

```{r}
ruta <- "https://github.com/DMorgon/portafolios/raw/main"
rama <- "alimentacion/datos_preprocesados"
archivo <- "tabla_procesada"
archivo_url <- paste0(ruta, "/", rama, "/", archivo, ".csv")
response <- GET(archivo_url)
data <- read_csv(rawToChar(response$content))
```

## 3. Análisis descriptivo de los datos

```{r}
View(data)
```

```{r}
str(data)
```
```{r}
summary(data)
```

Según los resultados obtenidos, las principales caracterisitas que presenta la tabla de datos son:

- El número total de observaciones del conjunto de datos es de 260.802
- El número total de variables son 6 de las cuales la variable respuesta es CONSUMOXCAPITA
- El tipo de variables son:
  - Númericas: AÑO, CONSUMOXCAPITA, GASTOXCAPITA, PRECIO
  - Categóricas: CATEGORIAS y REGION
- El rango temporal abarca desde el 2000 hasta el 2022
- Las variables CONSUMOXCAPITA, GASTOXCAPITA y PRECIO tienen valores ausentes.

## 4. Ajuste de tipo de variables

En el conjunto de datos he encontrado tres variables donde el tipo de datos no se corresponde con la naturaleza del valor que contiene:
- Año debería ser de tipo fecha ya que almacena el año en la que se recogieron los datos para el resto de variables.
- CATEGORIAS y REGION cuyo tipo de datos son cadenas de caracter pero que hay que transformar factor para que sea una variable categórica.

Transformo la variable año a tipo fecha: 

```{r}
data[["AÑO"]] <- as.Date(as.character(data[["AÑO"]]), format = "%Y")
```

A continuación transformo las variables categóricas Categorias y Región a factor

```{r}
data[["REGION"]] <- as.factor(data[["REGION"]])
data[["CATEGORIAS"]] <- as.factor(data[["CATEGORIAS"]])

```

## 5. Detección y tratamiento de valores ausentes

Como he visto anteriormente, existen valores ausentes. A continuación, calculo los valores ausentes por variable y total del conjunto de datos

```{r}
data %>%
  summarise(
    Variable = c("CONSUMOXCAPITA", "GASTOXCAPITA", "PRECIO", "TOTAL"),
    Suma_NA = c(
      sum(is.na(CONSUMOXCAPITA)),
      sum(is.na(GASTOXCAPITA)),
      sum(is.na(PRECIO)),
      sum(rowSums(is.na(.)))
    ),
    Porcentaje_NA = c(
      mean(is.na(CONSUMOXCAPITA)) * 100,
      mean(is.na(GASTOXCAPITA)) * 100,
      mean(is.na(PRECIO)) * 100,
      mean(rowMeans(is.na(.))) * 100
    )
  )

```

Como se puede ver, el porcentaje de valores ausentes en total es el 0.92 por 100 y si nos fijamos por variables, ninguno sobrepasa el 5 por 100. La variable que está más cerca es PRECIO con el 4.93 por 100.

## 6. Identificación de valores atípicos

## 7. Análisis de la variable respuesta: CONSUMOXCAPITA
## 7. Correlación de variables
## 8. Modelado de datos

```{r}
rm(list = ls())
```

